# Practica 1: Control de ServoMotores del Skybot 
## Ejercicio 1. Generación de ondas PWM con ciclo de trabajo.
En este ejercicio programaremos los recursos del micro TM4C123GH6PM de nuestro placa de desarrollo para generar una señal PWM con ciclo de trabajo controlable mediante los botones de la placa. La señal, que saldrá por el terminal PF2 de la placa, se conectará a la señal de datos (cable blanco), de un servo, para controlar su velocidad en función del ciclo de trabajo seleccionado.
También se generará una segunda señal con un valor de amplitud fijo, por el terminal PF3.

Para determinar el valor de STOPCOUNT, ten en cuenta las indicaciones del servo: en teoría una anchura de pulso de 1520uS mantendría al servo parado (si has trucado correctamente el servo) . Si para este valor no se para modificarlo (por ahora se recomienda usar ese valor como una primera aproximación y usar los pulsadores para ajustar la anchura de pulso hasta lograr que el servo se detenga. En ese momento puedes parar la aplicación, observar el valor del registro y cambiar STOPCOUNT a este valor para futuras ejecuciones. Puede que prefieras poner, momentáneamente, NUM_PASOS  a otro valor mayor para este ajuste fino inicial). 
Ten en cuenta que los periféricos que puedes usar (Timer o PWM) suelen tener un tamaño máximo de registro de 16 bits, por lo que un reloj del periférico a mucha frecuencia puede resultar en valores demasiado grandes.
Necesitarás usar valores de reloj menores que los “habituales” -lo que implica relojes del sistema a menor frecuencia de la habitual y/o factores de división altos en los relojes de periférico-. 

En cuanto a los valores de COUNT_1MS y COUNT_2MS, ahora mismo es muy complicado calcularlos (estamos trabajando en “bucle abierto”), por lo que se recomienda colocarlos “ a ojo” (simplemente acelerando el motor, observando cuando parece que la rueda ya no va más rápido al pulsar el botón, y depurando el programa para ver el valor en ciclos). En realidad, la velocidad máxima del servo en uno y otro sentido depende de varios factores:
* Máxima variación de error en el circuito de realimentación del servo
* Máxima corriente que se puede entregar al motor ? cambiará cuando el motor se alimente a diferente tensión (5V o 3.3V) o con diferente batería (un puerto USB tiene un límite de 500mA; una pila puede llegar a ofrecer más corriente)
* Características y simetría de la curva error/velocidad del servo.

Construye la aplicación y descárgala en la placa (se recomienda conectar en primer lugar las conexiones del servo a la placa, antes de conectar el cable USB de la placa al PC). Pon en marcha la aplicación, y comprueba que funciona (al pulsar los botones debería aumentar y disminuir la velocidad de giro del servo conectado a PF2; el servo conectado a PF3 se debe mover a velocidad fija desde el inicio). Calcula los valores más adecuados para  para MINCOUNT, STOPCOUNT y MAXCOUNT.
## Ejercicio 2. Caracterización básica de los servos de Skybot.
Utiliza el programa generado en el apartado anterior, en el que se hace uso de la API TIVAware para la programación de una onda PWM de control de un servo para realizar (!de nuevo!) la caracterización básica de los servos izquierdo y derecho de tu Skybot. Abre los servos (con cuidado!! pregunta a los profesores al menos la primera vez!!) y, teniendo establecido el ciclo de trabajo a la anchura de parada (1520uS), mueve ligeramente el potenciómetro hasta que el motor se pare. Con cuidado vuelve a cerrar los servos, procurando no volver a mover el potenciómetro. No te preocupes si no consigues parar exactamente los servos en la anchura de parada: el servo sufre
golpes y rozamientos que pueden mover ligeramente el potenciometro cambiando el valor teórico. Una vez cerrado, modifica ligeramente el valor de STOPCOUNT hasta conseguir que se corresponda con un estado de parada (puede que en vez de 1520us sea finalmente 1500 o 1580us).
También puedes realizar una estimación de los valores máximos y mínimos de cuenta para cada servo simplemente observando en que momento la rueda parece “dejar de ir más rápido”. En vez de usar unos valores fijos MINCOUNT,  y MAXCOUNT, (que serán distintos para cada servo), tra
aproximación es considerar la curva de velocidad respecto al ciclo de trabajo como lineal y simétrica con respecto a la cuenta de parada, 
STOPCOUNT  y asignar un mismo límite de variación con respecto al valor “central” (esto es ,  COUNT_1MS =  STOPCOUNT – VALOR, y COUNT_2MS =  STOPCOUNT + VALOR). Más adelante podremos realizar una estimación un poco más precisa de los valores máximo de velocidad en uno y otro sentido.
## Ejercicio 3. Control simultáneo de ambos servos
En los apartados anteriores hemos trabajado con una sola señal PWM variable, la obtenida en el pin PF2. En este ejercicio se propone que la señal PWM por PF3 también sea variable,  para poder conseguir diferentes tipos de desplazamiento para el robot Skybot.
### Ejercicio 3A. Movimiento rectilíneo del Skybot
Diseña un programa o aplicación que permite controlar un movimiento rectilíneo del Skybot, tanto hacia delante como hacia atrás. Partiendo desde una posición de parada, al pulsar el botón izquierdo de la TIVA, el robot debe avanzar de forma recta a una velocidad cada vez mayor, hasta alcanzar una velocidad límite; si el robot está avanzando, la pulsación del botón derecho dará lugar a una disminución de la velocidad de avance hasta llegar al estado de parada y, a partir de aquí, un movimiento de retroceso a cada vez mayor velocidad hasta llegar a la velocidad máxima de retroceso. Puedes programar un Timer que se encargue de ir reduciendo y aumentando paulatinamente la anchura de la onda PWM a un determinado ritmo para no tener que apretar mas los botones mas que una sola vez. Ten en cuenta que ahora, para cambiar la velocidad, deberemos modificar simultáneamente el control de ambos servos, de forma que las ruedas se mantengan moviéndose a la misma velocidad.
### Ejercicio 3B. Movimiento curvo del Skybot 
Para poder mover al Skybot siguiendo una trayectoria curva, basta con aplicar un movimiento diferencial  a sus ruedas, es decir, mover estas a diferentes velocidades. Si la rueda izquierda se mueve a más velocidad que la derecha, el microbot girará a la derecha con un ángulo mayor cuanto mayor sea la diferencia de velocidad; si por el contrario se mueve a menos velocidad, el microbot girará hacia la izquierda con un ángulo mayor cuanto mayor sea su diferencia. En este ejercicio se arrancará con el robot moviéndose hacia delante a la mitad de la máxima velocidad posible de avance (ambos servos con el mismo valor de avance, pero en sentido contrario). Uno de los servos (por ejemplo, el derecho), permanecerá moviéndose a esa velocidad de arranque, sin cambios, durante toda la ejecución de la aplicación. El otro, y considerando que al arranque está funcionando a mitad de velocidad de avance, disminuirá su velocidad al pulsar el botón izquierdo, hasta como mucho su estado de parada; y aumentará su velocidad al pulsar el botón derecho hasta alcanzar su velocidad máxima. De esta forma se conseguirá realizar diversos movimientos curvos en el microbot, siempre en un sentido de avance.
### Ejercicio 3C. Movimiento rotatorio del Skybot 
El movimiento con trayectoria curva conseguido en el ejercicio anterior a través del movimiento diferencial de sus servos tiene el inconveniente de que es necesario un cierto ángulo de giro en la trayectoria, lo cual impide la realización de giros rápidos. No obstante, si consideramos que cada uno de los servos tiene dos posibles sentidos de giro, podemos conseguir en el Skybot un movimiento de rotación sobre su punto central sin más que aumentar simultáneamente la velocidad de giro de uno de los servos en un sentido, y la del otro servo  en el otro sentido. De esta forma podemos conseguir un movimiento rotatorio que permita realizar giros rápidos. En este ejercicios se propone partir de un estado con ambos servos parados e imprimir un movimiento de rotación hacia la izquierda al pulsar el botón izquierdo, cada vez más rápido a medida que se pulsa mas veces dicho botón. Si al estar rotando el microbot hacia la izquierda se pulsa el botón derecho, la velocidad de rotación hacia la izquierda irá disminuyendo hasta llegar al estado de parada. A partir de entonces, las pulsaciones del botón derecho imprimirán un movimiento de rotación hacia la derecha cada vez más rápido hasta llegar a su valor máximo.
